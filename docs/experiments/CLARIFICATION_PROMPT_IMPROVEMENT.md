# 명료화 프롬프트 개선안

## 📊 개선 배경

### 기존 설문조사 결과 (2025년 9월, 9명 참여)

#### ✅ 강점 (유지)
```yaml
명료화_과정_가치: 4.4점
  증언:
    - "명료화 과정이 최종 정답보다 더 큰 배움을 줬다"
    - "질문을 구체화하도록 유도하는 점이 가장 큰 강점"
    - "내가 무엇을 모르는지 스스로 규정할 수 있게 되었다"
    - "문제를 조건·정의·목표로 분리해 재정의하는 연습이 됨"

재사용_의향: 4.4점
추천_의향: 4.3점
```

#### ❌ 문제점 (개선 필요)
```yaml
시간_효율성: 3.1점
  - "수식 입력에 시간이 과도하게 소요"
  - "명료화 과정이 너무 길어서 답답함"

기능_복잡성: 2.9점
  - "기능이 너무 많아 헷갈림"
  - "에이전트와 프리패스의 기능 분리가 불명확"

사용법_안내: 필요
  - "에이전트 모드와 프리패스 모드의 용도 설명 필요"
  - "처음엔 뭘 물어야 할지 막막함"
```

---

## 🎯 핵심 개선 목표

### 1. **교육적 의도 명시화**
```
문제: 학생이 "왜 명료화하는지" 이해 못함
결과: "그냥 답 알려주면 되는데 왜 자꾸 물어봐?" → 방어적 태도
해결: 명료화의 목적을 부드럽게 설명
```

### 2. **시간 효율성 향상**
```
문제: 모든 질문에 일괄적 명료화 → 시간 소요
결과: 3.1점 "답답함"
해결: 3단계 전략으로 빠른 질문은 빠르게, 깊은 질문은 깊게
```

### 3. **메타인지 훈련 명시화**
```
문제: 메타인지 훈련이 암묵적 (우연한 부산물)
결과: 체계적 훈련 X
해결: "생각하는 법 배우기" 프레임 명시
```

---

## 📋 현재 프롬프트 분석

### ✅ 잘된 점 (유지할 요소)

```yaml
1. 자연스러운_대화_톤:
   현재: "어떤 부분이 더 궁금하신가요? 😊"
   평가: ✅ 친근하고 따뜻함
   
2. 명료화_1개_원칙:
   현재: "복잡한 질문이나 여러 질문 금지"
   평가: ✅ 간결함 유지
   
3. 상황별_유연성:
   현재: "열린 질문 vs 선택지 제공"
   평가: ✅ 맥락에 따라 조절
```

### ❌ 부족한 점 (개선 필요)

| 문제 | 현재 상태 | 개선 방향 |
|------|-----------|----------|
| **의도 설명 없음** | 질문만 던짐 | 왜 묻는지 설명 추가 |
| **일률적 처리** | 모든 질문 동일 방식 | 3단계 전략 적용 |
| **메타인지 암묵적** | 간접적 훈련만 | 명시적 프레이밍 |
| **과도한 명료화** | 규칙 없음 | 효율성 최적화 규칙 |

---

## ✨ 개선안 1: 교육적 의도 프레이밍

### AS-IS (현재)
```
명료화 질문 예시:
- "어떤 부분이 더 궁금하신가요? 😊"
- "수열의 어떤 내용을 알고 싶으신가요?"
```

### TO-BE (개선)

#### 3단계 프레이밍 전략

```yaml
레벨 A - 간결한 설명 (매우 모호한 질문용):
  목적: 빠른 진행, 학생 협조 유도
  형식: "[간단한 이유] + [질문]"
  
  예시:
    "질문을 조금만 더 구체적으로 만들어주면, 딱 맞는 설명을 해드릴게요!
     어떤 부분이 궁금해? 😊"

레벨 B - 교육적 설명 (약간 모호한 질문용):
  목적: 교육적 가치 전달, 메타인지 시작
  형식: "[교육적 의도] + [질문] + [격려]"
  
  예시:
    "함께 질문을 구체화해볼까요? 🎯
     네가 정확히 무엇을 모르는지 찾는 게 학습의 시작이에요!
     
     [구체적 질문]"

레벨 C - 메타인지 강조 (구체적이나 불명확한 질문용):
  목적: 깊은 사고 유도, 메타인지 훈련
  형식: "[메타인지 격려] + [열린 질문] + [교육적 힌트]"
  
  예시:
    "좋은 질문은 좋은 답변을 만들어요! 💡
     
     [열린 질문]
     
     (스스로 생각해보는 연습이 진짜 실력을 키워줘!)"
```

---

## ✨ 개선안 2: 3단계 명료화 전략

### 질문 모호도별 접근 방식

#### Stage 1: Quick Scope (매우 모호)

```yaml
대상_질문:
  - "수열"
  - "이차함수"
  - "함수 알려줘"
  특징: 단어 1-2개, 범위 불명확

전략:
  - 2-4개 구체적 선택지 제시
  - 레벨 A 프레이밍
  - 빠른 범위 좁히기

목적:
  - 시간 효율성 최우선
  - 학생 좌절감 방지

예시:
  학생: "수열 알려줘"
  
  AI 응답:
  "수열에 대해 알고 싶구나! 😊
   질문을 조금만 더 구체적으로 만들어주면, 딱 맞는 설명을 해드릴게요!
   
   어떤 부분이 궁금해?
   1️⃣ 수열이 뭔지 (정의)
   2️⃣ 수열 공식들
   3️⃣ 수열 문제 푸는 방법
   4️⃣ 수열의 종류"
```

#### Stage 2: Specific Clarify (약간 모호)

```yaml
대상_질문:
  - "수열 공식"
  - "이차함수 그래프"
  - "등차수열 알려줘"
  특징: 주제 명확, 세부사항 불명확

전략:
  - 선택한 범위 내 세부 확인
  - 레벨 B 프레이밍
  - 교육성과 효율성 균형

목적:
  - 정확한 학습 목표 파악
  - 교육적 가치 전달

예시:
  학생: "수열 공식이요"
  
  AI 응답:
  "함께 질문을 구체화해볼까요? 🎯
   
   수열 공식 중에서도 여러 가지가 있어:
   • 등차수열 공식 (일반항, 합)
   • 등비수열 공식 (일반항, 합)
   • 계차수열 공식
   
   어느 것을 배우고 싶어?"
```

#### Stage 3: Deep Understanding (약간 구체적)

```yaml
대상_질문:
  - "등차수열 일반항 공식"
  - "이차함수 꼭짓점 구하는 방법"
  특징: 세부사항 포함, 의도 불완전

전략:
  - 열린 질문으로 진짜 이해도 파악
  - 레벨 B 또는 C 프레이밍
  - 메타인지 훈련 요소 포함

목적:
  - 깊은 학습 유도
  - 메타인지 능력 향상

예시:
  학생: "등차수열 일반항 공식이요"
  
  AI 응답:
  "등차수열 일반항 공식에 대해 알고 싶구나!
   
   혹시 어떤 부분이 어렵거나 궁금한지 말해줄 수 있어?
   (예: 공식 유도 과정, 사용 방법, 왜 그런 형태인지 등)
   
   (정확히 무엇을 모르는지 아는 것부터가 스스로 공부하는 능력을 키워줘! 💡)"
```

---

## ✨ 개선안 3: 효율성 최적화 규칙

### 과도한 명료화 방지

#### 규칙 1: answerable 우선 판단
```yaml
원칙: "충분히 구체적이면 바로 답변"

적용_기준:
  - 질문 길이 > 10단어
  - 세부사항 명시 (예: "유도 과정", "사용법")
  - 단원 + 개념 + 목적 모두 포함

예시:
  질문: "이차함수의 꼭짓점을 구하는 완전제곱식 변형 방법"
  판단: answerable ✅
  이유: 충분히 구체적, 명료화 불필요
```

#### 규칙 2: 맥락 활용 최우선
```yaml
원칙: "이전 대화에서 참조 가능하면 명료화 생략"

적용_기준:
  - "그거", "이거" + 맥락 명확
  - MAICE 제안 → 학생 수락
  - 최근 답변 내용 참조 명확

예시:
  MAICE: "등비수열 공식을 배워볼까?"
  학생: "응, 그거!"
  판단: answerable ✅
  이유: 맥락상 "등비수열 공식" 명확
```

#### 규칙 3: 단계 건너뛰기
```yaml
원칙: "상황에 따라 유연하게 적용"

패턴_1_빠른_진행:
  질문: "함수"
  전략: Stage 1 건너뛰고 Stage 2
  이유: 너무 광범위, 바로 세부 범위 제시

패턴_2_즉시_답변:
  질문: "수열의 정의와 예시, 그리고 실생활 활용"
  전략: 모든 Stage 건너뛰고 answerable
  이유: 이미 충분히 구체적
```

#### 규칙 4: 명료화 횟수 제한
```yaml
원칙: "같은 세션에서 명료화 2회 이상 → 적극적 answerable"

이유:
  - 학생 피로 최소화
  - "답답함" 방지
  - 학습 흐름 유지

적용:
  - 1-2회 명료화: 정상 진행
  - 3회째부터: answerable 우선 판단
  - 학생이 계속 모호하게 답변 → 현재 수준에서 최선의 답변 제공
```

---

## ✨ 개선안 4: 메타인지 훈련 강화

### 명료화 = 메타인지 훈련 프레임

```yaml
기존_방식:
  question_only:
    - "어떤 부분이 궁금하신가요?"
    - 명료화만 함
    - 교육적 의도 숨김

개선_방식:
  question_with_metacognitive_frame:
    opening: "함께 생각해보자! 🤔"
    question: "[구체적 질문]"
    educational_note: "(네가 뭘 모르는지 아는 게 학습의 시작이야!)"
```

### 메타인지 요소 포함 가이드

```yaml
항상_포함:
  - "함께 생각해보자"
  - "네가 정확히 무엇을 모르는지"
  - "질문을 구체화하는 연습"

선택적_포함:
  - "좋은 질문은 좋은 답변을 만들어요"
  - "스스로 생각하는 능력"
  - "(이 과정이 진짜 학습이에요)"

절대_금지:
  - 너무 길고 교훈적인 설명
  - "너는 모르니까 내가 알려줄게" 톤
  - 학생을 가르치려는 상황
```

---

## 📊 전략 선택 매트릭스

### 질문 특성별 전략 매핑

| 질문 유형 | 예시 | Stage | 프레이밍 | 목적 |
|----------|------|-------|---------|------|
| **초단순** | "수학", "함수" | 1 | A | 빠른 범위 확정 |
| **매우 모호** | "이차함수" | 1 | A | 선택지 제공 |
| **약간 모호** | "이차함수 공식" | 2 | B | 세부 확인 |
| **약간 구체적** | "이차함수 꼭짓점 공식" | 3 | B/C | 의도 파악 |
| **충분히 구체적** | "꼭짓점 공식 유도" | answerable | - | 바로 답변 |
| **맥락 있음** | "그거" (참조 명확) | answerable | - | 맥락 활용 |

### 질문 길이별 기준

```yaml
1-2_단어:
  예: "수열", "함수"
  전략: Stage 1
  
3-5_단어:
  예: "수열 공식", "이차함수 그래프"
  전략: Stage 2
  
6-10_단어:
  예: "등차수열 일반항 공식"
  전략: Stage 3 또는 answerable
  
10단어_이상:
  예: "이차함수의 꼭짓점을 구하는 완전제곱식 변형 방법"
  전략: answerable
```

---

## 📝 개선된 프롬프트 구조

### 시스템 프롬프트에 추가할 섹션

```yaml
## 명료화 질문 생성 전략 (개선 버전 v3.0)

### 1. 교육적 의도 명시 (Intent Framing)

모든 명료화 질문은 다음 중 하나의 프레이밍을 포함하세요:

레벨 A (간결한 설명) - Stage 1 사용:
  "질문을 조금만 더 구체적으로 만들어주면, 딱 맞는 설명을 해드릴게요!"

레벨 B (교육적 설명) - Stage 2, 3 사용:
  "함께 질문을 구체화해볼까요? 🎯
   네가 정확히 무엇을 모르는지 찾는 게 학습의 시작이에요!"

레벨 C (메타인지 강조) - Stage 3 심화:
  "좋은 질문은 좋은 답변을 만들어요! 💡
   스스로 생각해보는 연습을 해볼까요?"

### 2. 3단계 명료화 전략

Stage 1: Quick Scope (매우 모호한 질문)
- 대상: 1-2단어, 범위 불명확
- 방법: 2-4개 구체적 선택지 제시
- 프레이밍: 레벨 A
- 목적: 시간 효율성

예시 형식:
  "[주제]에 대해 알고 싶구나! 😊
   질문을 조금만 더 구체적으로 만들어주면, 딱 맞는 설명을 해드릴게요!
   
   어떤 부분이 궁금해?
   1️⃣ [옵션1]
   2️⃣ [옵션2]
   3️⃣ [옵션3]
   4️⃣ [옵션4]"

Stage 2: Specific Clarify (약간 모호한 질문)
- 대상: 주제 명확, 세부사항 불명확
- 방법: 범위 내 세부 확인
- 프레이밍: 레벨 B
- 목적: 정확한 의도 파악

예시 형식:
  "함께 질문을 구체화해볼까요? 🎯
   
   [주제] 중에서도:
   • [세부옵션1]
   • [세부옵션2]
   • [세부옵션3]
   
   어느 것을 배우고 싶어?"

Stage 3: Deep Understanding (약간 구체적)
- 대상: 세부사항 포함, 의도 불완전
- 방법: 열린 질문 + 메타인지
- 프레이밍: 레벨 B 또는 C
- 목적: 깊은 이해, 메타인지 훈련

예시 형식:
  "[주제]에 대해 알고 싶구나!
   
   혹시 어떤 부분이 어렵거나 궁금한지 말해줄 수 있어?
   (예: [구체적 예시1], [예시2], [예시3] 등)
   
   (정확히 무엇을 모르는지 아는 것부터가 스스로 공부하는 능력을 키워줘! 💡)"

### 3. 효율성 최적화 규칙

규칙 1: answerable 우선 판단
- 질문 길이 > 10단어 → answerable 검토
- 세부사항 명시 → answerable 우선
- 단원+개념+목적 모두 포함 → answerable

규칙 2: 맥락 활용 최우선
- "그거", "이거" + 맥락 명확 → answerable
- MAICE 제안 수락 → answerable
- 최근 답변 참조 명확 → answerable

규칙 3: 과도한 명료화 방지
- 같은 세션 명료화 2회 이상 → 3회째부터 answerable 우선
- 학생 피로 최소화
- 충분히 구체적이면 바로 답변

규칙 4: 단계 건너뛰기 허용
- "함수" 같은 초광범위 → Stage 1 생략, Stage 2로
- "정의와 예시와 활용" → 모든 Stage 생략, answerable

### 4. 전략 선택 플로우차트

```
질문 입력
    ↓
맥락 참조 가능? → YES → answerable
    ↓ NO
질문 길이 > 10단어? → YES → answerable 검토
    ↓ NO
세부사항 명시? → YES → answerable 검토
    ↓ NO
needs_clarify 확정
    ↓
질문 길이 1-2단어? → YES → Stage 1 (레벨 A)
    ↓ NO
질문 길이 3-5단어? → YES → Stage 2 (레벨 B)
    ↓ NO
질문 길이 6-10단어? → YES → Stage 3 (레벨 B/C)
    ↓
전략 적용 및 응답 생성
```
```

---

## 📋 JSON 출력 예시

### Stage 1 예시 (매우 모호한 질문)

```json
{
  "knowledge_code": "K1",
  "quality": "needs_clarify",
  "missing_fields": ["구체적 주제", "학습 목적"],
  "unit_tags": ["수열"],
  "clarification_questions": [
    "수열에 대해 알고 싶구나! 😊\n질문을 조금만 더 구체적으로 만들어주면, 딱 맞는 설명을 해드릴게요!\n\n어떤 부분이 궁금해?\n1️⃣ 수열이 뭔지 (정의)\n2️⃣ 수열 공식들\n3️⃣ 수열 문제 푸는 방법\n4️⃣ 수열의 종류"
  ],
  "clarification_reasoning": "질문이 '수열'로만 되어 있어 범위가 매우 넓습니다. Stage 1 전략을 적용하여 4가지 주요 학습 방향을 선택지로 제시하고, 레벨 A 프레이밍으로 명료화의 목적을 간단히 설명하여 학생의 협조를 유도합니다. 시간 효율성을 위해 빠르게 범위를 좁히는 것이 목표입니다."
}
```

### Stage 2 예시 (약간 모호한 질문)

```json
{
  "knowledge_code": "K1",
  "quality": "needs_clarify",
  "missing_fields": ["공식 종류"],
  "unit_tags": ["수열", "등차수열", "등비수열"],
  "clarification_questions": [
    "함께 질문을 구체화해볼까요? 🎯\n\n수열 공식 중에서도 여러 가지가 있어:\n• 등차수열 공식 (일반항, 합)\n• 등비수열 공식 (일반항, 합)\n• 계차수열 공식\n\n어느 것을 배우고 싶어?"
  ],
  "clarification_reasoning": "'수열 공식'이라는 범위가 주어졌으나, 등차/등비/계차 등 여러 종류가 있어 구체화가 필요합니다. Stage 2 전략을 적용하여 3가지 주요 공식 유형을 제시하고, 레벨 B 프레이밍으로 명료화의 교육적 의도를 전달합니다. 네가 정확히 무엇을 모르는지 찾는 과정이 학습의 시작임을 암시합니다."
}
```

### Stage 3 예시 (약간 구체적, 메타인지 훈련)

```json
{
  "knowledge_code": "K2",
  "quality": "needs_clarify",
  "missing_fields": ["학습 목적 (유도/사용법/이해)"],
  "unit_tags": ["등차수열", "일반항"],
  "clarification_questions": [
    "등차수열 일반항 공식에 대해 알고 싶구나!\n\n혹시 어떤 부분이 어렵거나 궁금한지 말해줄 수 있어?\n(예: 공식 유도 과정, 사용 방법, 왜 그런 형태인지 등)\n\n(정확히 무엇을 모르는지 아는 것부터가 스스로 공부하는 능력을 키워줘! 💡)"
  ],
  "clarification_reasoning": "이미 '등차수열 일반항 공식'이라고 구체적으로 명시했으나, 공식의 어떤 측면(유도/사용/이해)을 원하는지 불명확합니다. Stage 3 전략을 적용하여 열린 질문을 통해 진짜 학습 목표를 파악하며, 레벨 C 프레이밍으로 메타인지 훈련 요소를 포함합니다. 스스로 생각하는 능력을 키우는 것이 진짜 학습임을 강조합니다."
}
```

### answerable 예시 (효율성 최적화)

```json
{
  "knowledge_code": "K2",
  "quality": "answerable",
  "missing_fields": [],
  "unit_tags": ["이차함수", "꼭짓점", "완전제곱식"],
  "clarification_questions": [],
  "clarification_reasoning": "질문이 '이차함수의 꼭짓점을 구하는 완전제곱식 변형 방법'으로 충분히 구체적입니다. 단원(이차함수), 개념(꼭짓점), 방법(완전제곱식), 목적(구하는 방법)이 모두 명시되어 있어 추가 명료화 없이 바로 답변 가능합니다. 효율성 최적화 규칙 1에 따라 answerable로 분류하여 과도한 명료화를 방지합니다."
}
```

---

## 📈 기대 효과

### 정량적 목표

| 지표 | 현재 | 목표 | 개선 방법 |
|------|------|------|----------|
| **명료화 가치** | 4.4점 | 4.7점 | 메타인지 프레이밍 |
| **시간 효율** | 3.1점 | 3.8점 | 3단계 전략 + 최적화 |
| **복잡도 인식** | 2.9점 | 3.8점 | 의도 명시화 |
| **전체 만족도** | 4.0점 | 4.5점 | 종합 개선 |
| **재사용 의향** | 4.4점 | 4.6점 | 효율성 향상 |

### 정성적 목표

```yaml
학생_이해도:
  기존: "왜 이걸 묻지?"
  목표: "아, 나를 도와주려는 거구나!"
  방법: 교육적 의도 명시

학습_경험:
  기존: "답답해, 시간 오래 걸려"
  목표: "빠르게 진행되면서도 배우는 게 있어"
  방법: 단계별 전략

메타인지:
  기존: "우연히 배운 부산물"
  목표: "의도적인 메타인지 훈련"
  방법: 명시적 프레이밍
```

---

## 🚀 구현 계획

### Phase 1: 프롬프트 업데이트 (1-2일)
- [ ] `config.yaml`에 개선안 적용
- [ ] 3단계 전략 섹션 추가
- [ ] 효율성 규칙 섹션 추가
- [ ] 예시 업데이트

### Phase 2: 내부 테스트 (3-5일)
- [ ] 개발팀 자체 테스트
- [ ] 다양한 질문 유형으로 검증
- [ ] Stage 분류 정확도 확인
- [ ] 프레이밍 자연스러움 평가

### Phase 3: 파일럿 테스트 (1주)
- [ ] 5-10명 학생 참여
- [ ] 기존 vs 개선 프롬프트 비교
- [ ] 피드백 수집
- [ ] 미세 조정

### Phase 4: A/B 테스트 포함 (실험 기간)
- [ ] A/B 테스트에 반영
- [ ] 효과 측정 (설문 항목 포함)
- [ ] 데이터 분석
- [ ] 최종 개선

---

## 📊 A/B 테스트 검증 항목

### 새로운 측정 지표

```yaml
명료화_관련_설문_추가:
  Q_new_1:
    질문: "명료화 질문의 목적을 이해할 수 있었나요?"
    척도: 1-5점
    목표: 4.5점 이상
  
  Q_new_2:
    질문: "명료화 과정이 빠르게 진행되었나요?"
    척도: 1-5점
    목표: 4.0점 이상 (기존 3.1점 대비)
  
  Q_new_3:
    질문: "명료화 과정에서 '생각하는 법'을 배웠나요?"
    척도: 1-5점
    목표: 4.5점 이상

시스템_로그_분석:
  - Stage별 분포 (1/2/3/answerable)
  - 명료화 횟수 (세션당 평균)
  - 명료화 소요 시간
  - answerable 직행률
```

---

## 🎓 이론적 배경

### 소크라테스식 대화의 현대적 구현

```yaml
전통적_소크라테스_방식:
  - 답을 주지 않고 질문으로 이끔
  - 모순을 드러내고 스스로 깨닫게 함
  - 산파술(Maieutics): 진리를 '낳도록' 도움

MAICE_명료화_과정:
  - 답을 바로 주지 않고 질문을 구체화
  - "네가 무엇을 모르는지" 스스로 발견
  - 명료화 = 메타인지 훈련 도구

개선안의_차별성:
  - 의도를 명시적으로 설명
  - 효율성과 교육성 균형
  - 단계별 접근으로 유연성 확보
```

### Vygotsky의 발판(Scaffolding)

```yaml
근접발달영역(ZPD):
  현재_수준: "막연하게 모르겠다"
  ↓ [Stage 1: 범위 좁히기]
  중간_수준: "이 부분이 궁금하구나"
  ↓ [Stage 2: 세부 확인]
  목표_근접: "정확히 이게 모르는 거구나"
  ↓ [Stage 3: 깊은 이해 or 답변]
  목표_도달: "이해했다!"

개선안_적용:
  - 3단계 = 점진적 Scaffolding
  - 각 Stage가 다음 수준으로 발판
  - 프레이밍 = 정서적 지원(emotional scaffolding)
```

---

## 📚 참고 자료

### 관련 문서
- `/analysis/MAICE_User_Survey_Analysis.md` - 기존 설문 결과
- `/analysis/Agent_vs_Freepass_Mode_Comparison.md` - 모드 비교
- `/docs/experiments/AB_TEST_EXPERIMENT_PLAN.md` - A/B 테스트 계획

### 기술 문서
- `/agent/agents/question_classifier/prompts/config.yaml` - 현재 프롬프트

---

## ✅ 체크리스트

### 프롬프트 개선 전
- [ ] 현재 프롬프트 백업
- [ ] 기존 설문 결과 재검토
- [ ] 개선 목표 명확화

### 개선안 적용
- [ ] 3단계 전략 섹션 추가
- [ ] 프레이밍 레벨 정의
- [ ] 효율성 규칙 추가
- [ ] 예시 업데이트

### 테스트 및 검증
- [ ] 내부 테스트
- [ ] 파일럿 테스트
- [ ] A/B 테스트 반영
- [ ] 효과 측정

### 지속 개선
- [ ] 피드백 수집
- [ ] 데이터 분석
- [ ] 프롬프트 미세 조정
- [ ] 문서 업데이트

---

**이 개선안은 "명료화 과정이 최종 정답보다 더 큰 배움"(4.4점)이라는 강점을 유지하면서, "시간 효율성"(3.1점)과 "복잡성"(2.9점) 문제를 해결하기 위해 설계되었습니다.**

